<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="./tactics.js"></script>
    <style>
        body {
            font: 12px sans-serif;
        }

        p {
            font: 16px sans-serif;
            line-height: 1.5;
            margin-left: 40px;
            margin-right: 40px;
            margin-top: 20px;
        }

        .axis {
            font: 10px sans-serif;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

    </style>
</head>
<title>MITRE ATT&CK</title>
<body>
<button disabled=true class="back-button">Back</button>
<button onclick="loadTactics()" class="next-button">Next</button>
<h1>MITRE ATT&CK: Tactics & Techniques</h1>
<p>
    The MITRE ATT&CK framework (https://attack.mitre.org/) is a standard way of describing cyber attacks. Cyber attacks
    commonly proceed in stages, which are presented to the left starting with "Initial Access" all the way through to
    "Impact". Each of these is referred to as a <b>tactic</b>.Tactics are high-level, describing the primary phases of
    a cyber attack. Within each tactic there are many <b>techniques</b> which describe more specific behaviours
</p>


</body>


<script>

    var page = 0;

    var color = d3.scaleOrdinal().domain(tactics.map(d => d.stage)).range(d3.schemeCategory20);

    var margin = {top: 20, right: 20, bottom: 70, left: 180},
        width = 1000 - margin.left - margin.right,
        height = 800 - margin.top - margin.bottom;

    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    var y = d3.scaleBand().domain(tactics.map(d => d.stage)).range([0, height]).paddingInner(0.10);

    svg.selectAll("bar")
        .data(tactics)
        .enter().append("rect")
            .style("fill", function(d, i) {return color(d.stage);})
            .attr("x", 0 )
            .attr("width", 0)
            .attr("y", function(d) { return y(d.stage); })
            .attr("height",  y.bandwidth())
        .on("mouseover", function(d) {
            var y_stage = y(d.stage);
            svg.append("g").selectAll("tacticDescription")
                .data(d.description)
                .enter().append("text")
                .attr("class", "tacticDescription")
                .attr("x", 0.1 * width)
                .attr("y", y_stage )
                .attr("dy", function(d, i) {return (i * 1.5) + "em";})
                .style("font", "16px sans-serif")
                .attr("dx", "-.8em")
                .text(function(d) { return d; })
                .attr("fill", "black");
        })
        .on("mouseout", function () {
            d3.selectAll(".tacticDescription").remove();
        })
        .transition().duration(500).delay(function (d, i) {return 200 * i;})
            .attr("width", 0.05 * width);

    svg.append("g").selectAll("tacticLabel")
        .data(tactics)
        .enter().append("text")
        .attr("x", 0)
        .attr("y", function(d) { return y(d.stage) + y.bandwidth() / 2; })
        .attr("dy", ".35em")
        .attr("fill", "white")
        .style("font", "sans-serif")
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .text(function(d) { return d.stage.replaceAll("-", " ").toUpperCase(); })
        .transition().duration(500).delay(function (d, i) {return 200 * i;})
        .attr("fill", "black");

    var loadTactics = function() {
        d3.select(".next-button")
            .attr("onClick", "document.location='usages.html'");

        d3.select(".back-button")
            .attr("disabled", null)
            .attr("onClick", "document.location='index.html'");

        d3.csv("tactics-ordered.csv", function (error, data) {
            d3.select("p")
                .text("This bar chart shows how frequently each tactic is used by various Cyber threat actors. Each " +
                    "tactic encompasses many, specific techniques. For an example, the \"Initial Access\" tactic " +
                    "includes the techniques \"Spearphishing Link\" and \"Spearphishing Attachment\".");

            var x = d3.scaleLinear().domain([0, d3.max(data, function (d) {
                return +d.value;
            })]).range([0, width]);

            svg.selectAll("bar")
                .data(data)
                .enter().append("rect")
                .style("fill", function(d) {return color(d.tactic);})
                .attr("x", 0 )
                .attr("width", 0.05 * width)
                .attr("y", function(d) { return y(d.tactic); })
                .attr("height",  y.bandwidth())
                .on("mouseover", function(d) {
                    svg.append("g")
                        .append("text")
                        .attr("class", "tacticCount")
                        .attr("x", x(d.value))
                        .attr("y", y(d.tactic) + y.bandwidth() / 2 )
                        .style("font", "16px sans-serif")
                        .style("text-anchor", "end")
                        .attr("dx", "-1em")
                        .attr("dy", ".3em")
                        .text(d.value)
                        .attr("fill", "white");
                })
                .on("mouseout", function() {
                    svg.selectAll(".tacticCount").remove()
                })
                .transition().duration(1000).delay(function (d, i) {return 300 * i;})
                .attr("width", function (d) { return x(d.value); } );

            svg.append("g")
                .attr("transform",
                    "translate(" + 0 + "," + height + ")")
                .call(d3.axisBottom(x).tickValues([0, 100, 200, 300, 400, 500]));

            // svg.append("g")
            //     .append("text")
            //     .attr("x", x(data[3].value) + 20)
            //     .attr("y", y(data[3].tactic) + 20)
            //     .style("font", "16px sans-serif")
            //     .text("Why is this one so big?");

        });
    };

    var sceneThree = function() {
        console.log("sceneThree!!!");
    };

</script>


